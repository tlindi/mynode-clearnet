# Clearnet App Setup & Uninstall Guide

This README documents the installation and removal process for the Clearnet app, including environment setup, package management, certificate handling, and cleanup procedures. All operations are designed to be idempotent, traceable, and safe for root execution.

---

## ğŸ› ï¸ Installation Script (`clearnet_install.sh`)

### âœ… Core Setup
Defines key environment variables:

```bash
APP=clearnet
APP_DATADIR=/mnt/hdd/mynode/clearnet
LETSENCRYPT_HOME=/etc/letsencrypt
LETSENCRYPT_DATADIR=$APP_DATADIR/letsencrypt
LETSENCRYPT_BACKUPDIR=/mnt/hdd/mynode/clearnet_backup/letsencrypt
MYNODE_CERTDIR=/home/bitcoin/.mynode/https
ğŸ“¦ Package Installation
Installs required packages only if missing:

certbot

python3-certbot

python3-certbot-nginx

Each action is logged with [INFO], [SKIP], or [ERROR].

ğŸ” Letâ€™s Encrypt Migration
Handles migration of certificate data:

Skips if /etc/letsencrypt is already a symlink to $LETSENCRYPT_DATADIR

If it's a real directory:

Creates one-time .org backup

Creates timestamped .tgz backup

Moves contents to $LETSENCRYPT_DATADIR

Replaces original with symlink

ğŸ”— HTTPS Certificate Symlinks
Reads domain from $APP_DATADIR/https_domain

Creates symlinks in $MYNODE_CERTDIR:

node.<domain>.crt â†’ fullchain.pem

node.<domain>.key â†’ privkey.pem

Aborts if symlinks already exist

ğŸ§¹ Uninstall Script (clearnet_uninstall.sh)
ğŸ§¾ Backup Before Removal
Creates timestamped .tgz backup of /etc/letsencrypt

Skips if directory doesn't exist

ğŸ”— Symlink Cleanup
Removes symlinks from $MYNODE_CERTDIR based on https_domain

Skips if domain file or symlinks don't exist

ğŸ”„ Restore Original State
Removes /etc/letsencrypt if it's a symlink

Aborts if it's a real directory

Restores from .org backup

ğŸ§¼ Directory Cleanup
Removes:

/opt/mynode/clearnet

$APP_DATADIR

Skips if not found.

ğŸ“¦ Package Removal
Purges:

certbot

python3-certbot

python3-certbot-nginx

Also runs:

bash
apt autoremove -y
ğŸ§¾ Logging
All actions are logged with [INFO], [SKIP], or [ERROR] for clarity and traceability.

ğŸ§  Design Principles
Idempotent logic: avoids overwriting existing data

Safe backups: .org and .tgz formats

Explicit control: checks all conditions, avoids assumptions

Clear logging: consistent tags for traceability

Root-safe: no sudo, assumes root execution